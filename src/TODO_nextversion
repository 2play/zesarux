--------Para próxima versión:
 
-meter real tape en linea comandos siempre acelera la carga, aunque este desactivado
 ejemplo: ./zesarux --realtape tetris2.pzx

-Revisar al expulsar cinta si Windows lo libera 

-Compilar windows con:
export CFLAGS "-I/c/openssl-1.1.1d-win32-mingw/include"
export LDFLAGS "-L/c/openssl-1.1.1d-win32-mingw/lib"
./configure --enable-ssl --enable-memptr --enable-visualmem --enable-cpustats

-probar ssl en windows. Descargando prebuilds de ssl para mingw
https://wiki.openssl.org/index.php/Binaries
https://bintray.com/vszakats/generic/openssl
https://bintray.com/vszakats/generic/download_file?file_path=openssl-1.1.1d-win32-mingw.zip

copiar libcrypto-1_1.dll y libssl-1_1.dll en ruta de ZEsarUX exe
Incluir pthreadGC-3.DLL
Funciona ssl en windows ok!


-En overscan con curses salen colores con ??? a la derecha fuera de pantalla 

-Ping pong sonido en Inves?

-Impresión caracteres en consola texto nunca debe mostrar el 127. Es Delete
Quizá mostrar C en caso de 127


-Opción para que ocr no busque en caracteres que diga 23606/7. Que lo haga solo en la de la rom y listo
Esto evitaria en teoría que por ejemplo en great escape salen caracteres paréntesis a veces en el escenario 

-Opción para formato de grabación de autosave snap


-decir que ssl mac requiere "brew install openssl"
Habra otra libssl de sistema?

-Comentar que se compile con ssl para soportar descargas completas de spectrum


-como incluir libreria ssl en mac? hace falta /usr/local/opt/openssl/lib/libssl.1.0.0.dylib

-vertificar roms ifrom, lista que sea valida de distribucion

---Cosas Next
-tbblue: the "disable ULA" bit in $68 doesn't work, so ULA is visible over the tilemap ( https://specnext.dev/wiki/ULA_Control_Register )

-aumentar tbblue mmc a 64 mb?
-tbblue mmc no puede incluir archivos de cpm que hay que descargarse
-tbblue. registro 6b bit 1: 1	1 to activate 512 tile mode (bit 0 of tile attribute is ninth bit of tile-id)
-tbblue:NEW in core 3.0:
Bit 3 enables "text mode" where the tile-graphic is defined as 1-bit B&W bitmap 
(same as UDG = User Defined Graphic characters on original ZX Spectrum) => 
one tile needs only 8 bytes to define graphics. The tile-map data are also interpreted differently, 
the associated flag byte is 7:1 split, the bottom bit 0 being still "ULA over tm" or "ninth bit of tile number", 
but the top 7 bits are extended palette offset. The transparency is then checked against the global transparency colour
 (after the colour lookup in the palette), not against the four bit tilemap transparency colour-index.
 -menu info video tbblue cuando son inks y papers no cabe entero. probar con angry floaters por ejemplo

Tilemap Control Register - SpecNext official Wiki
-tbblue modo turbo 28 MHz
-warhawk no se ven sprites!!
-Mantener archivo de especificaciones de next (la lista completa de los registros internos) tal cual como los emulo. Así es más fácil saber cuando agregan o modifican algo nuevo 
-Ensamblador opcodes extendidos next
-Puerto dffd next
https://specnext.dev/wiki/Next_Memory_Bank_Select
---Fin cosas Next


-porque en algunos cores nested, debug_nested_core_call_previous se llama al principio y otros al final?


-tabla de joystick to event siempre se resetea??

-permitir que las direcciones de breakpoints se pongan con 0xNNNN ademas de NNNNh y decimal
incluso con $NNNN


-pulsar ESC en item que se esta escuchando en el menu, cierra el menu
-items [X] no son amigables en speech, no se entienden. Deberian decir "yes" o "no"
Corregir speech menus:

-si item empieza por [, buscar hasta cierre ]. Y eso se reproduce al final de linea
-Si [X], se dice "enabled". Si [ ], se dice "disabled"

Esto hacerlo en stdout y menu normal. En decir linea entera y en active item. Funcion solo para esto y que no se use en otros sitios

-opción nueva para curses, stout y simpletext para forzar render gráfico tipo tsconf


-Semáforo en debug print tiene sentido??
Quiza por el sprintf (pending_error_message
 para que no se pudiera escribir desde dos sitios?

-semáforos en Windows. Como? De momento no hace bloqueo si es Windows 

-si la primera vez arranca con driver stdout, se abre el menu directamente, quiza porque va a mostrar tooltips o changelog




-Quizá problema de sonido y threads en Windows no es cosa del threads en audio, sino threads en timer?
Desactivar threads en uno u otro caso según lo que corrija el sonido 


-emular este bit de eff7 en pentagon:
port EFF7: (adressation 1110xxxx xxxx0xxx )
D3 = 1 - disable rom and connect ram page 0 in adress space 0-3FFF

-preguntar si incluir algunas demos de 16C



-Spool file funciona en cpc?



-no lee enlaces simbolicos en filesystem: ejemplo /home/pi/PREPARADOS de raspiboy


-Error unpaws????
Thread 8 Crashed:
0   libsystem_kernel.dylib        	0x00007fff736102c6 __pthread_kill + 10
1   libsystem_pthread.dylib       	0x00007fff736cbbf1 pthread_kill + 284
2   libsystem_c.dylib             	0x00007fff7357a745 __abort + 144
3   libsystem_c.dylib             	0x00007fff7357aff3 __stack_chk_fail + 205
4   zesarux                       	0x0000000106702e13 util_paws_dump_vocabulary + 2019
5   zesarux                       	0x0000000106703a08 util_unpawsetc_dump_words + 104 (utils.c:14074)
6   zesarux                       	0x00000001066a1c5e menu_unpaws_ungac + 46 (menu.c:22138)


-Estadísticas de uso:
-uso medio de cpu?

 
-Interceptar salida midi chip ay y enviarlo a midi real. Probar con programa de addon midi de zxuno

-Selección de instrumento midi en midi export y midi output, para cada canal


-en audiosdl, si en MINGW, desactivar threads. Asi podemos hacer compilacion de Windows, usando threads, pero el audio sin threads
Esto hará que el audio se escuche bien en windows en la versión con threads (porque actualmente no se escucha bien en windows con threads)


--RED:

-el compilado final de mac hay que hacerlo sin ssl? O ver si enlaza con la ssl del sistema operativo. Si no, igual se puede incluir la de homebrew de manera estática
Parece que depende del de brew:
~iMac-de-Cesar:src cesarhernandez$ ./zesarux --noconfigfile --ao null
dyld: Library not loaded: /usr/local/opt/openssl/lib/libssl.1.0.0.dylib
  Referenced from: /Users/cesarhernandez/Documents/ZEsarUX/zesarux/src/./zesarux
  Reason: image not found
Abort trap: 6




-funciones zsock no permito usarlas sin pthreads. Por que?

-Query zsock http que detecte si query es mayor que 1024 y de error


-zsock http request: Buffer response en z80_byte y no char

-rutinas zsock_read_all: deberia reintentar un par o dos de veces si no se ha alcanzado la longitud deseada
o bien, que quien llame ahi, que mire si se ha llegado al final de lo esperado
o bien que al principio se diga la longitud de lo que se envia-> util para get-snapshot


-Quizá en Windows para saber si un socket tiene datos para leer, usar llamada a read con 0 bytes y devolverá error si no hay bytes para leer?
Prueba en windows:
-http browser y juegos funciona
-zeng recibe conexiones pero peta al cabo de unos segundos
-zeng haciendo como master inicia la conexion pero no parece recibir el prompt


Ejemplos generales socket
https://www.binarytides.com/socket-programming-c-linux-tutorial/


--Fin RED



--ZENG:

-probar doom mania (juego a dobles al doom)

-que al activar ZENG, active ZRCP si no esta. Pero solo cuando hay soporte de threads

-que permita ZENG en todos los cores de maquinas

*que se guarde la config de los parametros

*revisar buffers envio snapshot: con target renegade y cliente linux ha petado varias veces. bubble bobble ha petado al cabo de un rato
*con remoto y cliente mac, target renegade, bubble bobble y match day ok. match sin apenas delay, el resto con mucho delay (remoto en nueva zelanda)


*joystick real deberia enviar tambien evento sobre esto. cuidado con eventos de joystick que generan teclas,
estos no deberian generar doble evento (joystick y tecla)

-joystick y ZENG:
--Joystick físico o cursores debe generar eventos de envía Tecla con código especial. Entra en función Antes de envío por ZENG. Quizá en funciones de joystick_send_**?
--Joystick que activa Kempston, Sinclair, qaop, fuller etc activa esos puertos desde operaciones.c y no llama a envía Tecla
--Joystick que genera Tecla redefinida, entra a envía Tecla pero después de ZENG, para no generar dos eventos

Así los dos usuarios deben tener seleccionado el mismo tipo de joystick en menú. Así también como si hay redefinido joystick a Tecla, deben estar iguales en ambos 
Lo ideal en dos jugadores es que si uno usa joystick, lo haga con tipo de joystick de menú: Kempston, qaop, Fuller etc. Y no use definición de joystick a Tecla, para evitar tener que redefinir los dos usuarios lo mismo

PERO:
-cursor llama a joystick_set_**
Se generarían dos eventos de esta manera. Pero se llama después de ZENG
Entonces envía cursor pero no joystick. Esto enviaría cursor remotamente por ZENG y generaría al final movimiento de joystick

-real joystick también llama a joystick_set_**. Quizá este joystick set no debe generar evento ZENG. Hay que generar evento ZENG al pulsar real joystick quizá 


Entonces:
-cursor envía evento ZENG de cursor
-pulsar joystick real debe agregar envío evento ZENG de código especial joystick 
-joystick real a Tecla definida no debe llamar a ZENG por la Tecla. Solo envía ZENG el movimiento de joystick (caso anterior)



*que pregunte confirmacion en destino si quiere aceptar, mostrando la ip de origen
*en remote.c, bufferes de longitud MAX_LENGTH_PROTOCOL_COMMAND deberian ser con malloc
Ademas habria que hacer que MAX_LENGTH_PROTOCOL_COMMAND sea un poco mayor que ZRCP_GET_PUT_SNAPSHOT_MEM


*Quizá en sigpipe puede averiguar que socket ha fallado?
Quizá sigpipe se puede gestionar diferente para cada thread?
*funciones de envio snapshot, teclas y mensajes, deberian ver si reciben remote prompt? al llamar a zsock_read_all_until_command
*detectar si no hay ningun master, o si los dos son master? como?
:mirando estado local y remoto. Avisar si el estado no es 1 master y 1 slave. comando nuevo ZRCP para esto
:quiza se puede permitir ningun master, pero lo que no deberia ser es dos master. Al menos avisar de esto y que el usuario ya decida

Ampliar buffer de recepción y el de copia. Y asignarlos por malloc 

*parar thread zeng y cerrar socket zeng al salir emulador
*network: en windows siempre retorna datos disponibles. corregirlo. comentado en este TODO tambien
*asegurarse que cuando conecte zeng contra remoto al principio, retorna el prompt esperado. Ya lee version pero quiza 
habria que hacer que leyera el primer prompt correcto

*revisar ZRCP: ahora al gestionar sigpipe quiza ya no peta al desconectarse el socket remoto

*realjoystick_set_reset_key: quiza ahi deberia llamar a util_set_reset_key_continue, para que lo procese directamente zeng, y quitar
zeng_send_key_event de la funcion realjoystick_set_reset_key

* ZRCP: habría que protegerlo con user y password, por si alguien abre ese puerto en remoto en el router 

-check_pending_zrcp_put_snapshot de momento solo para el core de spectrum

--Fin ZENG



-página man de ZEsarUX. que no diga opciones, que haga referencia a --help y --experthelp



-Probar malloc en 32 bit de 2 gb

-Joystick en Mac
Parece que en Mac es complicado
Ver
https://stackoverflow.com/questions/2234364/how-to-detect-a-gamepad-button-press-on-osx-10-5-and-higher
y
https://code.google.com/archive/p/ddribin/

https://github.com/suzukiplan/gamepad-osx

https://github.com/ThemsAllTook/libstem_gamepad


Quizá en OSX superiores lo han simplificado. Pero hace falta swift o funciona con C?

Y Windows sdl?

-Fin Joystick en Mac



-separar los extras en otro repo? Reinicializar repositorio de ZEsarUX?




-Enter cpu step en ZRCP con drivers null stdout y simpletext. Se puede abrir menú con drivers null y simpletext? Con printf verbose error?

-Incluir sonic y otros en juegos TSConf. Pedir permiso a autores 

-utils.c: In function ‘util_extract_hdf’:
utils.c:11099:18: warning: this decimal constant is unsigned only in ISO C90
                  2147483648L, //8. 2 GB
                  ^
utils.c: In function ‘util_ascii_to_binary’:
utils.c:11248:9: warning: this decimal constant is unsigned only in ISO C90
         const unsigned int mascara=(unsigned int)2147483648;

Puede dar problemas?




-hex editor: muestra pagina entera cuando una zona de memoria por ejemplo solo es de 2 bytes. Probar por ejemplo con debug memory zone

-para comprobar coordenada y footer, calcular desde abajo de alto ventana. Y usar funcion comun en screen.c
-quiza funcion footer a scr_putchar_footer_comun_zoom se tiene que hacer con coordenadas 0,1 o 2 simplemente

-file browser no muestra dispositivos. importante para uart
Por alguna razón, en /dev no llega a leerlos ni entrando antes del filtro. Quiza algun parametro especial del directorio
o algo que no hago bien al leer directorio. La solución pasa por escribir el nombre directamente en el file selector (pulsando TAB o click de raton
arriba)

-ventana debug cpu: si se estaba en vista 8, y luego cargamos un juego que no sea de paws/daad/quill,
la vista 1 sera ventana grande pero con alto total reducido. Parecido a lo que sucedia al cambiar de vista


-uso de settings.c y settings.h. revisar que tiene que ir ahi ?


-unpaws con quill:
*compression tokens existen?

-unpaws: 
*compression tokens no siempre estan hasta el 255


-Turbo spool setting en tbblue -> va relacionado con la funcion de peek_byte turbo que se ve alterada al cambiar la velocidad de la cpu en nextos

-ejemplos para spool, como:
./txt_to_basic_lines.sh FAQ 3 si si no > pruebaspool2.txt

-al salir emulador desde exit-emulator de ZRCP no acaba de salir del todo. Luego salgo con ctrl-c y el footer luego arranca desactivado


-leer audio casette

-En mostrar registros IR
Decir cuál es el vector de interrupción 

-cpuid ("zxid") según especificación de mcleod

-al cargar smartload, por ejemplo ultimo cargado es thelosttapesofalbion. situa el cursor ahi bien, pero al subir para arriba desplaza desde scroll sin mover
cursor hasta que esta arriba. O sea, deberia mover siempre cursor y no empezar a hacer scroll hasta que no esta arriba

-reorganizar capturas de pantalla del readme.md para que esten todas las maquinas
-en github, Screenshot sir Fred pixel y ascii todo junto. el de ascii, esta cortado
-Revisar archivo install. En caso de Linux y otros binarios ya compilados, enseñarlo más fácilmente. Otro documento quizá que diga cómo compilarlo  


-temperatura cpu en mac
https://github.com/lavoiesl/osx-cpu-temp


-parece que cocoa no opengl no redibuja... que hago? lo corrijo o solo dejo cocoa opengl?

-quiza version mac debe tener dos versiones: una compilada con O2, otra sin
Que hacemos con cocoa no opengl?


-------- Fin cosas para la siguiente version

