/*
    ZEsarUX  ZX Second-Emulator And Released for UniX
    Copyright (C) 2013 Cesar Hernandez Bano

    This file is part of ZEsarUX.

    ZEsarUX is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

#include "cpu.h"
#include "operaciones.h"
#include "debug.h"

#include "contend.h"
#include "zxuno.h"
#include "tbblue.h"
#include "screen.h"

void invalid_opcode_ed(char *s)
{
	//debug_printf(VERBOSE_ERR,"Invalid opcode %s. Final PC: %X",s,reg_pc);


        //Para que no se queje el compilador
        if (s) {}

}


void instruccion_ed_0 ()
{
        invalid_opcode_ed("ED0");
}

void instruccion_ed_1 ()
{
        invalid_opcode_ed("ED1");
}

void instruccion_ed_2 ()
{
        invalid_opcode_ed("ED2");
}

void instruccion_ed_3 ()
{
        invalid_opcode_ed("ED3");
}

void instruccion_ed_4 ()
{
        invalid_opcode_ed("ED4");
}

void instruccion_ed_5 ()
{
        invalid_opcode_ed("ED5");
}

void instruccion_ed_6 ()
{
        invalid_opcode_ed("ED6");
}

void instruccion_ed_7 ()
{
        invalid_opcode_ed("ED7");
}

void instruccion_ed_8 ()
{
        invalid_opcode_ed("ED8");
}

void instruccion_ed_9 ()
{
        invalid_opcode_ed("ED9");
}

void instruccion_ed_10 ()
{
        invalid_opcode_ed("ED10");
}

void instruccion_ed_11 ()
{
        invalid_opcode_ed("ED11");
}

void instruccion_ed_12 ()
{
        invalid_opcode_ed("ED12");
}

void instruccion_ed_13 ()
{
        invalid_opcode_ed("ED13");
}

void instruccion_ed_14 ()
{
        invalid_opcode_ed("ED14");
}

void instruccion_ed_15 ()
{
        invalid_opcode_ed("ED15");
}

void instruccion_ed_16 ()
{
        invalid_opcode_ed("ED16");
}

void instruccion_ed_17 ()
{
        invalid_opcode_ed("ED17");
}

void instruccion_ed_18 ()
{
        invalid_opcode_ed("ED18");
}

void instruccion_ed_19 ()
{
        invalid_opcode_ed("ED19");
}

void instruccion_ed_20 ()
{
        invalid_opcode_ed("ED20");
}

void instruccion_ed_21 ()
{
        invalid_opcode_ed("ED21");
}

void instruccion_ed_22 ()
{
        invalid_opcode_ed("ED22");
}

void instruccion_ed_23 ()
{
        invalid_opcode_ed("ED23");
}

void instruccion_ed_24 ()
{
        invalid_opcode_ed("ED24");
}

void instruccion_ed_25 ()
{
        invalid_opcode_ed("ED25");
}

void instruccion_ed_26 ()
{
        invalid_opcode_ed("ED26");
}

void instruccion_ed_27 ()
{
        invalid_opcode_ed("ED27");
}

void instruccion_ed_28 ()
{
        invalid_opcode_ed("ED28");
}

void instruccion_ed_29 ()
{
        invalid_opcode_ed("ED29");
}

void instruccion_ed_30 ()
{
        invalid_opcode_ed("ED30");
}

void instruccion_ed_31 ()
{
        invalid_opcode_ed("ED31");
}

void instruccion_ed_32 ()
{
        invalid_opcode_ed("ED32");
}

void instruccion_ed_33 ()
{
        invalid_opcode_ed("ED33");
}

void instruccion_ed_34 ()
{
        invalid_opcode_ed("ED34");
}

void instruccion_ed_35 ()
{
        if (MACHINE_IS_TBBLUE) {
                //swapnib           ED 23          4+4  A bits 7-4 swap with A bits 3-0
                z80_byte final_l=(reg_a>>4)&0x0F;
                z80_byte final_h=(reg_a<<4)&0xF0;
                reg_a=final_l|final_h;
        }
        else invalid_opcode_ed("ED35");
}

void instruccion_ed_36 ()
{
        if (MACHINE_IS_TBBLUE) {
                //mirror a          ED 24           4+4 mirror the bits in A
                //76543210 -> 01234567
                int i;
                z80_byte result_a=0;
                for (i=0;i<8;i++) {
                  result_a = result_a >> 1;
                  if (reg_a&128) result_a |=128;
                  reg_a=reg_a << 1;
                }

                reg_a=result_a;
        }  
        else invalid_opcode_ed("ED36");
}

void instruccion_ed_37 ()
{
        if (MACHINE_IS_TBBLUE) {
                //ld  hl,sp         ED 25          4+4 transfer SP to HL
                HL=reg_sp;
        }  
        else invalid_opcode_ed("ED37");
}

void instruccion_ed_38 ()
{
        if (MACHINE_IS_TBBLUE) {
                //mirror de         ED 26          4+4 mirror the bits in DE
                //15 14 13 12 11 10 9 8 76543210 -> 0123456789 10 11 12 13 14 15
                int i;
                z80_int result_de=0;
                for (i=0;i<16;i++) {
                  result_de = result_de >> 1;
                  if (DE&32768) result_de |=32768;
                  DE=DE << 1;
                }

                DE=result_de;
        }  
        else invalid_opcode_ed("ED38");
}

void instruccion_ed_39 ()
{
  
        if (MACHINE_IS_TBBLUE) {
                //test N            ED 27           4+4+3 And A with $XX and set all flags. A is not affected.
                //mismo que AND N pero sin afectar A
                z80_byte valor=lee_byte_pc();
                z80_byte temp_a=reg_a;
                temp_a &= valor; 
                Z80_FLAGS=FLAG_H | sz53p_table[temp_a]; 

        }  

        else invalid_opcode_ed("ED39");
}

void instruccion_ed_40 ()
{
        invalid_opcode_ed("ED40");
}

void instruccion_ed_41 ()
{
        invalid_opcode_ed("ED41");
}

void instruccion_ed_42 ()
{
        invalid_opcode_ed("ED42");
}

void instruccion_ed_43 ()
{
        invalid_opcode_ed("ED43");
}

void instruccion_ed_44 ()
{
        invalid_opcode_ed("ED44");
}

void instruccion_ed_45 ()
{
        invalid_opcode_ed("ED45");
}

void instruccion_ed_46 ()
{
        invalid_opcode_ed("ED46");
}

void instruccion_ed_47 ()
{
        invalid_opcode_ed("ED47");
}

void instruccion_ed_48 ()
{
        if (MACHINE_IS_TBBLUE) {
                //mul               ED 30          4+4  multiply HL*DE = HLDE (no flags set)
                int resultado=HL*DE;

                HL=(resultado>>16) & 0xFFFF;
                DE=resultado & 0xFFFF;
        }

        else invalid_opcode_ed("ED48");
}

void instruccion_ed_49 ()
{
        if (MACHINE_IS_TBBLUE) {
                //add  hl,a         ED 31          4+4  Add A to HL (no flags set)
                HL +=reg_a;
        }
        
        else invalid_opcode_ed("ED49");
}

void instruccion_ed_50 ()
{
        if (MACHINE_IS_TBBLUE) {
                //add  de,a         ED 32          4+4  Add A to DE (no flags set)
                DE +=reg_a;
        }
        
        else invalid_opcode_ed("ED50");
}

void instruccion_ed_51 ()
{
        if (MACHINE_IS_TBBLUE) {
                //add  bc,a         ED 33          4+4  Add A to BC (no flags set)
                BC +=reg_a;
        }  
        
        else invalid_opcode_ed("ED51");
}

void instruccion_ed_52 ()
{
        invalid_opcode_ed("ED52");
}

void instruccion_ed_53 ()
{
        invalid_opcode_ed("ED53");
}

void instruccion_ed_54 ()
{
        invalid_opcode_ed("ED54");
}

void instruccion_ed_55 ()
{
        if (MACHINE_IS_TBBLUE) {
                //inc dehl          ED 37          4+4 increment 32bit DEHL
                z80_long_int dehl= (DE << 16) | HL;
                dehl++;
                HL=dehl & 0xFFFF;
                DE=(dehl>>16) & 0xFFFF;
        }  
        
        else invalid_opcode_ed("ED55");
}

void instruccion_ed_56 ()
{
        if (MACHINE_IS_TBBLUE) {
                //dec dehl          ED 37          4+4 decrement 32bit DEHL
                z80_long_int dehl= (DE << 16) | HL;
                dehl--;
                HL=dehl & 0xFFFF;
                DE=(dehl>>16) & 0xFFFF;
        }  
        
        else invalid_opcode_ed("ED56");
}

void instruccion_ed_57 ()
{
        if (MACHINE_IS_TBBLUE) {
                //add dehl,a        ED 39          4+4 Add A to 32bit DEHL
                z80_long_int dehl= (DE << 16) | HL;
                dehl +=reg_a;
                HL=dehl & 0xFFFF;
                DE=(dehl>>16) & 0xFFFF;
        }  
        
        else invalid_opcode_ed("ED57");
}

void instruccion_ed_58 ()
{
        if (MACHINE_IS_TBBLUE) {
                //add dehl,bc       ED 3A           Add BC to 32bit DEHL
                z80_long_int dehl= (DE << 16) | HL;
                dehl +=BC;
                HL=dehl & 0xFFFF;
                DE=(dehl>>16) & 0xFFFF;
        }  
        
        else invalid_opcode_ed("ED58");
}

void instruccion_ed_59 ()
{
        if (MACHINE_IS_TBBLUE) {
                //add dehl,$0000    ED 3B LO HI    4+4 Add $0000 to 32bit DEHL
                z80_long_int dehl= (DE << 16) | HL;

                z80_int operador=0;
                operador |= lee_byte_pc();
                operador |= (lee_byte_pc()<<8);

                dehl +=operador;
                HL=dehl & 0xFFFF;
                DE=(dehl>>16) & 0xFFFF;
        }  
        
        else invalid_opcode_ed("ED59");
}

void instruccion_ed_60 ()
{
        if (MACHINE_IS_TBBLUE) {
                //sub dehl,a        ED 3C          4+4 Subtract A from 32bit DEHL
                z80_long_int dehl= (DE << 16) | HL;
                dehl -=reg_a;
                HL=dehl & 0xFFFF;
                DE=(dehl>>16) & 0xFFFF;
        }  
        
        else invalid_opcode_ed("ED60");
}

void instruccion_ed_61 ()
{
        if (MACHINE_IS_TBBLUE) {
                //sub dehl,bc       ED 3D          4+4 Subtract BC from 32bit DEHL
                z80_long_int dehl= (DE << 16) | HL;
                dehl -=BC;
                HL=dehl & 0xFFFF;
                DE=(dehl>>16) & 0xFFFF;
        }  
        
        else invalid_opcode_ed("ED61");
}

void instruccion_ed_62 ()
{
        invalid_opcode_ed("ED62");
}

void instruccion_ed_63 ()
{
        invalid_opcode_ed("ED63");
}


void instruccion_ed_64 ()
{
//IN B,(C)

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif

	reg_b=lee_puerto(reg_b,reg_c);
	set_flags_in_reg(reg_b);
}

void instruccion_ed_65 ()
{
//OUT (C),B

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif

	out_port(BC, reg_b);
}

void instruccion_ed_66 ()
{
//SBC HL,BC
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );

        sbc_hl( BC  );
}

void instruccion_ed_67 ()
{
//LD (NN),BC

        z80_int dir;

        dir=lee_word_pc();

        poke_byte(dir,reg_c);
        poke_byte(dir+1,reg_b);

	set_memptr(dir+1);

}

void instruccion_ed_68 ()
{
//NEG

	neg();
}

void instruccion_ed_69 ()
{
	//RETN
	iff1.v=iff2.v;
	reg_pc=pop_valor();

	//Si se vuelve de una nmi especial
	if (MACHINE_IS_ZXUNO && reg_pc==0x72) {
                //meter BOOTM a 0 (bit 0)
                zxuno_ports[0] &=(255-1);
	}


}

void instruccion_ed_70 ()
{
//coded70:                        ;IM 0
	im_mode=0;
}

void instruccion_ed_71 ()
{
//coded71:                        ;LD I,A
      contend_read_no_mreq( IR, 1 );

	reg_i=reg_a;
}

void instruccion_ed_72 ()
{
//IN C,(C)

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif

        reg_c=lee_puerto(reg_b,reg_c);
	set_flags_in_reg(reg_c);
}

void instruccion_ed_73 ()
{
//OUT (C),C

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif

        out_port(BC, reg_c);

}

void instruccion_ed_74 ()
{
//ADC HL,BC
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );

        adc_hl(BC);

}

void instruccion_ed_75 ()
{
//LD BC,(NN)
        z80_int dir;

        dir=lee_word_pc();

        reg_c=peek_byte(dir);
        reg_b=peek_byte(dir+1);

	set_memptr(dir+1);

}

void instruccion_ed_76 ()
{
//NEG

	neg();
}

void instruccion_ed_77 ()
{
//RETI
	iff1.v=iff2.v;
	reg_pc=pop_valor();
}

void instruccion_ed_78 ()
{
//coded70:                        ;IM 0
        im_mode=0;
}




void instruccion_ed_79 ()
{
//coded79:                        ;LD R,A
      contend_read_no_mreq( IR, 1 );

	reg_r=reg_a;
	reg_r_bit7=reg_a & 128;

	if (machine_emulate_memory_refresh) {
		//Emulacion refresco memoria superior en 48kb
		if (machine_emulate_memory_refresh_counter<MAX_EMULATE_MEMORY_REFRESH_COUNTER) {
			machine_emulate_memory_refresh_counter++;
		}

		//Hacer debug de esto de vez en cuando
		if ((machine_emulate_memory_refresh_counter%10000)==0) machine_emulate_memory_refresh_debug_counter();
	}

}

void instruccion_ed_80 ()
{
//IN D,(C)

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif

        reg_d=lee_puerto(reg_b,reg_c);
	set_flags_in_reg(reg_d);
}

void instruccion_ed_81 ()
{
//OUT (C),D

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif

        out_port(BC, reg_d);

}

void instruccion_ed_82 ()
{
//SBC HL,DE
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );

	sbc_hl( DE  );
}

void instruccion_ed_83 ()
{

//LD (NN),DE

        z80_int dir;

        dir=lee_word_pc();

        poke_byte(dir,reg_e);
        poke_byte(dir+1,reg_d);

	set_memptr(dir+1);

}

void instruccion_ed_84 ()
{
	neg();
}

void instruccion_ed_85 ()
{
	iff1.v=iff2.v;
	reg_pc=pop_valor();

}

void instruccion_ed_86 ()
{

//coded86:                        ;IM 1
	im_mode=1;
}

void instruccion_ed_87 ()
{
//LD A,I
      contend_read_no_mreq( IR, 1 );


        reg_a=reg_i;

	Z80_FLAGS=Z80_FLAGS & FLAG_C;

	Z80_FLAGS |=sz53_table[reg_a];

        if (iff2.v==1) Z80_FLAGS |=FLAG_PV;


}

void instruccion_ed_88 ()
{
//IN E,(C)

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif

        reg_e=lee_puerto(reg_b,reg_c);
	set_flags_in_reg(reg_e);
}

void instruccion_ed_89 ()
{
//OUT (C),E

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif

        out_port(BC, reg_e);

}

void instruccion_ed_90 ()
{
//ADC HL,DE
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );

        adc_hl(DE);


}

void instruccion_ed_91 ()
{
//coded91:                        ;LD DE,(NN)

        z80_int dir;

        dir=lee_word_pc();

	reg_e=peek_byte(dir);
	reg_d=peek_byte(dir+1);

	set_memptr(dir+1);


}

void instruccion_ed_92 ()
{
	neg();
}

void instruccion_ed_93 ()
{
	iff1.v=iff2.v;
	reg_pc=pop_valor();

}

void instruccion_ed_94 ()
{
//coded94:                        ;IM 2
	im_mode=2;
}

void instruccion_ed_95 ()
{
//coded95:                        ;LD A,R
      contend_read_no_mreq( IR, 1 );

	reg_a=(reg_r&127) | (reg_r_bit7 &128);


        Z80_FLAGS=Z80_FLAGS & FLAG_C;

        Z80_FLAGS |=sz53_table[reg_a];

	if (iff2.v==1) Z80_FLAGS |=FLAG_PV;

}

void instruccion_ed_96 ()
{
//IN H,(C)

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif

        reg_h=lee_puerto(reg_b,reg_c);
	set_flags_in_reg(reg_h);
}

void instruccion_ed_97 ()
{
//OUT (C),H

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif

        out_port(BC, reg_h);

}

void instruccion_ed_98 ()
{
//coded98:                        ;SBC HL,HL
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );


        sbc_hl( HL  );

}

void instruccion_ed_99 ()
{
//LD (NN),HL

        z80_int dir;
        dir=lee_word_pc();

        poke_byte(dir,reg_l);
        poke_byte(dir+1,reg_h);

	set_memptr(dir+1);

}

void instruccion_ed_100 ()
{
	neg();
}

void instruccion_ed_101 ()
{
	iff1.v=iff2.v;
	reg_pc=pop_valor();

}

void instruccion_ed_102 ()
{
//           ;IM 0/1
        im_mode=0;

}

void instruccion_ed_103 ()
{
//RRD

        z80_byte low_hl,low_hl_copia,high_hl,low_a,high_a;
        z80_byte bytehl;
	z80_int reg_temp_hl;


        reg_temp_hl=HL;
        bytehl=peek_byte(reg_temp_hl);
        contend_read_no_mreq( HL, 1 ); contend_read_no_mreq( HL, 1 );
        contend_read_no_mreq( HL, 1 ); contend_read_no_mreq( HL, 1 );

        low_hl_copia=low_hl=bytehl & 0xF;
        high_hl=(bytehl >> 4) & 0xF;
        low_a=reg_a & 0xF;

        //este sin rotar
        high_a=reg_a & 0xF0;

	low_hl=high_hl;
	high_hl=low_a;
	low_a=low_hl_copia;

        reg_a=high_a | low_a;
        bytehl=(high_hl<<4) | low_hl;

        poke_byte(HL,bytehl);


	//FLAG C no alterado
	Z80_FLAGS = Z80_FLAGS & FLAG_C;

	Z80_FLAGS |=sz53p_table[reg_a];

	//flags. The H and N flags are reset, P/V is parity, C is preserved, and S and Z are modified by definition.
	set_memptr(reg_temp_hl+1);


}

void instruccion_ed_104 ()
{
//IN L,(C)

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif

        reg_l=lee_puerto(reg_b,reg_c);
	set_flags_in_reg(reg_l);
}

void instruccion_ed_105 ()
{
//OUT (C),L

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif

        out_port(BC, reg_l);

}

void instruccion_ed_106 ()
{
//coded106:               ;ADC HL,HL
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );

	adc_hl(HL);
}

void instruccion_ed_107 ()
{
//LD HL,(NN)

        z80_int dir;

        dir=lee_word_pc();

        reg_l=peek_byte(dir);
        reg_h=peek_byte(dir+1);

	set_memptr(dir+1);

}

void instruccion_ed_108 ()
{
//NEG
	neg();
}

void instruccion_ed_109 ()
{
	iff1.v=iff2.v;
	reg_pc=pop_valor();

}

void instruccion_ed_110 ()
{
//           ;IM 0/1
        im_mode=0;

}



void instruccion_ed_111 ()
{

//RLD

	z80_byte low_hl,high_hl,low_a,low_a_copia,high_a;
	z80_byte bytehl;
	z80_int reg_temp_hl;


	reg_temp_hl=HL;
	bytehl=peek_byte(reg_temp_hl);

        contend_read_no_mreq( HL, 1 ); contend_read_no_mreq( HL, 1 );
        contend_read_no_mreq( HL, 1 ); contend_read_no_mreq( HL, 1 );


	low_hl=bytehl & 0xF;
	high_hl=(bytehl >> 4) & 0xF;

	low_a_copia=low_a=reg_a & 0xF;

	//este sin rotar
	high_a=reg_a & 0xF0;

	low_a=high_hl;
	high_hl=low_hl;
	low_hl=low_a_copia;

	reg_a=high_a | low_a;
	bytehl=(high_hl<<4) | low_hl;

	poke_byte(HL,bytehl);

        //FLAG C no alterado
        Z80_FLAGS = Z80_FLAGS & FLAG_C;

        Z80_FLAGS |=sz53p_table[reg_a];


	set_memptr(reg_temp_hl+1);

}

void instruccion_ed_112 ()
{
//IN F,(C). solo afecta flags
	z80_byte result;

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif

        result=lee_puerto(reg_b,reg_c);
        set_flags_in_reg(result);

}

void instruccion_ed_113 ()
{
//OUT (C),0

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif

	//Esto es diferente en NMOS y en CMOS
	if (MACHINE_IS_Z88) {
		//CMOS
		out_port(BC, 255);
	}

	else {
	        out_port(BC, 0);
	}
}

void instruccion_ed_114 ()
{
//coded114:               ;SBC HL,SP
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );

        sbc_hl( reg_sp  );

}

void instruccion_ed_115 ()
{
//coded115:               ;LD (NN),SP


        z80_int dir;

        dir=lee_word_pc();

        poke_word(dir,reg_sp);

	set_memptr(dir+1);

}

void instruccion_ed_116 ()
{
//NEG
	neg();
}

void instruccion_ed_117 ()
{
	iff1.v=iff2.v;
	reg_pc=pop_valor();

}


void instruccion_ed_118 ()
{
//           ;IM 0/1
        im_mode=0;

}


void instruccion_ed_119 ()
{
	invalid_opcode_ed("ED119");
}

void instruccion_ed_120 ()
{

//IN A,(C)

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif
        reg_a=lee_puerto(reg_b,reg_c);
	set_flags_in_reg(reg_a);

}

void instruccion_ed_121 ()
{
//OUT (C),A

#ifdef EMULATE_MEMPTR
        set_memptr(BC+1);
#endif
        out_port(BC, reg_a);

}

void instruccion_ed_122 ()
{
//coded122:               ;ADC HL,SP
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );
      contend_read_no_mreq( IR, 1 );

	adc_hl(reg_sp);

}

void instruccion_ed_123 ()
{
//coded123:               ;LD SP,(NN)
        z80_int dir;


        dir=lee_word_pc();

        reg_sp=peek_word(dir);

	set_memptr(dir+1);


}

void instruccion_ed_124 ()
{
//NEG
	neg();
}

void instruccion_ed_125 ()
{
	iff1.v=iff2.v;
	reg_pc=pop_valor();

}

void instruccion_ed_126 ()
{

//coded126:                        ;IM 2
        im_mode=2;


}

void instruccion_ed_127 ()
{
        invalid_opcode_ed("ED127");
}

void instruccion_ed_128 ()
{
        invalid_opcode_ed("ED128");
}

void instruccion_ed_129 ()
{
        invalid_opcode_ed("ED129");
}

void instruccion_ed_130 ()
{
        invalid_opcode_ed("ED130");
}

void instruccion_ed_131 ()
{
        invalid_opcode_ed("ED131");
}

void instruccion_ed_132 ()
{
        invalid_opcode_ed("ED132");
}

void instruccion_ed_133 ()
{
        invalid_opcode_ed("ED133");
}

void instruccion_ed_134 ()
{
        invalid_opcode_ed("ED134");
}

void instruccion_ed_135 ()
{
        invalid_opcode_ed("ED135");
}

void instruccion_ed_136 ()
{
        invalid_opcode_ed("ED136");
}

void instruccion_ed_137 ()
{
        invalid_opcode_ed("ED137");
}

void instruccion_ed_138 ()
{
        if (MACHINE_IS_TBBLUE) {
                //push NN        ED 8A LO HI   4+4+3+3+3+3 (3+3 for read, 3+3 for write)  push 16bit immediate value
                z80_int value=0;
                value |= lee_byte_pc();
                value |= (lee_byte_pc()<<8);
                push_valor( value );
        }

        else invalid_opcode_ed("ED138");
}

void instruccion_ed_139 ()
{

        if (MACHINE_IS_TBBLUE) {
                //POPX
                //popx              ED 8B         4+4  pop value and disguard
                reg_sp +=2;
        }

        else invalid_opcode_ed("ED139");
}

void instruccion_ed_140 ()
{
        invalid_opcode_ed("ED140");
}

void instruccion_ed_141 ()
{
        invalid_opcode_ed("ED141");
}

void instruccion_ed_142 ()
{
        invalid_opcode_ed("ED142");
}

void instruccion_ed_143 ()
{
        invalid_opcode_ed("ED143");
}

void instruccion_ed_144 ()
{
        invalid_opcode_ed("ED144");
}

void instruccion_ed_145 ()
{
	if (MACHINE_IS_TBBLUE) {
                //nextreg reg,val   ED 91 reg,val   Set a NEXT register (like doing out($243b),reg then out($253b),val )
		z80_byte registro=lee_byte_pc();
		z80_byte valor=lee_byte_pc();

		tbblue_set_register_port(registro);
		tbblue_set_value_port(valor);
                //if (puerto==TBBLUE_REGISTER_PORT) tbblue_set_register_port(value);
                //if (puerto==TBBLUE_VALUE_PORT) tbblue_set_value_port(value);
        }
        else invalid_opcode_ed("ED145");
}

void instruccion_ed_146 ()
{
	if (MACHINE_IS_TBBLUE) {
                //nextreg reg,a     ED 92 reg       Set a NEXT register using A (like doing out($243b),reg then out($253b),A )
		z80_byte registro=lee_byte_pc();

                tbblue_set_register_port(registro);
                tbblue_set_value_port(reg_a);
        }
        else invalid_opcode_ed("ED146");
}

void instruccion_ed_147 ()
{
        if (MACHINE_IS_TBBLUE) {
		//pixeldn ED 93	Moves HL down one line in the ULA screen
		printf ("pixeldn. hl=%d\n",reg_hl);
		int x,y;
		x=y=0;
		util_spectrumscreen_get_xy(reg_hl,&x,&y);
		printf ("x: %d y: %d\n",x,y);

		y=y+1;
		if (y>191) y=0;

                z80_int resultado=16384+screen_addr_table[y*32+x];

                reg_h=value_16_to_8h(resultado);
                reg_l=value_16_to_8l(resultado);	
		printf ("pixeldn after. hl=%d\n",reg_hl);

        }
        else invalid_opcode_ed("ED147");
}

void instruccion_ed_148 ()
{
	if (MACHINE_IS_TBBLUE) {
        	//pixelad ED 94	Using D as Y, and E as X, work out address of ULA screen address and store in HL 
		//screen_addr_table
		printf ("pixelad\n");
		int x=reg_e;
		int y=reg_d;
		z80_int resultado=16384+screen_addr_table[y*32+x];

		reg_h=value_16_to_8h(resultado);
		reg_l=value_16_to_8l(resultado);
        }
        else invalid_opcode_ed("ED148");
}

void instruccion_ed_149 ()
{
        invalid_opcode_ed("ED149");
}

void instruccion_ed_150 ()
{
        invalid_opcode_ed("ED150");
}

void instruccion_ed_151 ()
{
        invalid_opcode_ed("ED151");
}

void instruccion_ed_152 ()
{
        invalid_opcode_ed("ED152");
}

void instruccion_ed_153 ()
{
        invalid_opcode_ed("ED153");
}

void instruccion_ed_154 ()
{
        invalid_opcode_ed("ED154");
}

void instruccion_ed_155 ()
{
        invalid_opcode_ed("ED155");
}

void instruccion_ed_156 ()
{
        invalid_opcode_ed("ED156");
}

void instruccion_ed_157 ()
{
        invalid_opcode_ed("ED157");
}

void instruccion_ed_158 ()
{
        invalid_opcode_ed("ED158");
}


void instruccion_ed_159 ()
{
        invalid_opcode_ed("ED159");
}

void instruccion_ed_160 ()
{

//LDI

/*
LDD         --0*0-  Load and Decrement    [DE]=[HL],HL=HL-1,#
LDDR        --000-  Load, Dec., Repeat    LDD till BC=0
LDI         --0*0-  Load and Increment    [DE]=[HL],HL=HL+1,#
LDIR        --000-  Load, Inc., Repeat    LDI till BC=0
*/

	z80_byte byte_leido;

	byte_leido=peek_byte(HL);
	poke_byte(DE,byte_leido);

        contend_write_no_mreq( DE, 1 ); contend_write_no_mreq( DE, 1 );

	HL++;
	DE++;
	BC--;

	Z80_FLAGS &=(255-FLAG_H-FLAG_N-FLAG_PV-FLAG_3-FLAG_5);

	if (BC) Z80_FLAGS |=FLAG_PV;

	if (byte_leido & 8 ) Z80_FLAGS |=FLAG_3;

	if (byte_leido & 2 ) Z80_FLAGS |=FLAG_5;


}

void instruccion_ed_161 ()
{
//coded161:               ;CPI

	cpi_cpd_common();

        HL++;

	set_memptr(memptr+1);

}

void instruccion_ed_162 ()
{
//coded162:               ;INI
        z80_byte value,aux;

        contend_read_no_mreq( IR, 1 );


        value=lee_puerto(reg_b,reg_c);
        poke_byte(HL,value);
#ifdef EMULATE_MEMPTR
	set_memptr( BC+1  );
#endif
        reg_b--;
	HL++;

	aux=value+reg_c+1;
	if (value & 0x80) Z80_FLAGS |=FLAG_N;
	else Z80_FLAGS &=(255-FLAG_N);

	if (aux<value) {
		Z80_FLAGS |=FLAG_H|FLAG_C;
	}
	else {
		Z80_FLAGS &=(255-FLAG_H-FLAG_C);
	}

	Z80_FLAGS = (Z80_FLAGS & (255-FLAG_S-FLAG_Z-FLAG_3-FLAG_5) ) | sz53_table[reg_b];

	set_flags_parity(( aux & 0x07 ) ^ reg_b);

}

void instruccion_ed_163 ()
{
//coded163:               ;OUTI
	z80_byte value,aux;

        contend_read_no_mreq( IR, 1 );


        value=peek_byte(HL);


        reg_b--;

#ifdef EMULATE_MEMPTR
        set_memptr( BC+1  );
#endif
        out_port(BC,value);

        HL++;

        aux=value+reg_l;
        if (value & 0x80) Z80_FLAGS |=FLAG_N;
        else Z80_FLAGS &=(255-FLAG_N);

        if (aux<value) {
                Z80_FLAGS |=FLAG_H|FLAG_C;
        }
        else {
                Z80_FLAGS &=(255-FLAG_H-FLAG_C);
        }

        Z80_FLAGS = (Z80_FLAGS & (255-FLAG_S-FLAG_Z-FLAG_3-FLAG_5) ) | sz53_table[reg_b];

        set_flags_parity(( aux & 0x07 ) ^ reg_b);

}

void instruccion_ed_164 ()
{
        invalid_opcode_ed("ED164");
}

void instruccion_ed_165 ()
{
        invalid_opcode_ed("ED165");
}

void instruccion_ed_166 ()
{
        invalid_opcode_ed("ED166");
}

void instruccion_ed_167 ()
{
        invalid_opcode_ed("ED167");
}

void instruccion_ed_168 ()
{
//LDD

	z80_byte byte_leido;

	byte_leido=peek_byte(HL);
        poke_byte(DE,byte_leido);

        contend_write_no_mreq( DE, 1 ); contend_write_no_mreq( DE, 1 );

        HL--;
        DE--;

        BC--;


        Z80_FLAGS &=(255-FLAG_H-FLAG_N-FLAG_PV-FLAG_3-FLAG_5);

        if (BC) Z80_FLAGS |=FLAG_PV;

        if (byte_leido & 8 ) Z80_FLAGS |=FLAG_3;

        if (byte_leido & 2 ) Z80_FLAGS |=FLAG_5;



}

void instruccion_ed_169 ()
{
//coded169:               ;CPD

        cpi_cpd_common();

        HL--;

	set_memptr(memptr-1);


}

void instruccion_ed_170 ()
{
//coded170:               ;IND
        z80_byte value,aux;

        contend_read_no_mreq( IR, 1 );


        value=lee_puerto(reg_b,reg_c);
        poke_byte(HL,value);
#ifdef EMULATE_MEMPTR
        set_memptr( BC-1  );
#endif

        reg_b--;
        HL--;

        aux=value+reg_c-1;
        if (value & 0x80) Z80_FLAGS |=FLAG_N;
        else Z80_FLAGS &=(255-FLAG_N);

        if (aux<value) {
                Z80_FLAGS |=FLAG_H|FLAG_C;
        }
        else {
                Z80_FLAGS &=(255-FLAG_H-FLAG_C);
        }

        Z80_FLAGS = (Z80_FLAGS & (255-FLAG_S-FLAG_Z-FLAG_3-FLAG_5) ) | sz53_table[reg_b];

        set_flags_parity(( aux & 0x07 ) ^ reg_b);



}

void instruccion_ed_171 ()
{
//coded171:               ;OUTD
        z80_byte value,aux;

        contend_read_no_mreq( IR, 1 );


        value=peek_byte(HL);

        reg_b--;

#ifdef EMULATE_MEMPTR
        set_memptr( BC-1  );
#endif
        out_port(BC,value);

        HL--;

        aux=value+reg_l;
        if (value & 0x80) Z80_FLAGS |=FLAG_N;
        else Z80_FLAGS &=(255-FLAG_N);

        if (aux<value) {
                Z80_FLAGS |=FLAG_H|FLAG_C;
        }
        else {
                Z80_FLAGS &=(255-FLAG_H-FLAG_C);
        }

        Z80_FLAGS = (Z80_FLAGS & (255-FLAG_S-FLAG_Z-FLAG_3-FLAG_5) ) | sz53_table[reg_b];

        set_flags_parity(( aux & 0x07 ) ^ reg_b);



}

void instruccion_ed_172 ()
{
        invalid_opcode_ed("ED172");
}

void instruccion_ed_173 ()
{
        invalid_opcode_ed("ED173");
}

void instruccion_ed_174 ()
{
        invalid_opcode_ed("ED174");
}

void instruccion_ed_175 ()
{
        invalid_opcode_ed("ED175");
}

void instruccion_ed_176 ()
{

//LDIR

#ifdef EMULATE_MEMPTR
        if (reg_b!=0 || reg_c!=1) set_memptr(reg_pc-1);
#endif

	//instruccion_ed_160();

        z80_byte byte_leido;

        byte_leido=peek_byte(HL);
        poke_byte(DE,byte_leido);

        contend_write_no_mreq( DE, 1 );
	contend_write_no_mreq( DE, 1 );

	BC--;

        Z80_FLAGS &=(255-FLAG_H-FLAG_N-FLAG_PV-FLAG_3-FLAG_5);

        if (byte_leido & 8 ) Z80_FLAGS |=FLAG_3;

        if (byte_leido & 2 ) Z80_FLAGS |=FLAG_5;

        if (BC) {
	  Z80_FLAGS |=FLAG_PV;
          contend_write_no_mreq( DE, 1 );
	  contend_write_no_mreq( DE, 1 );
          contend_write_no_mreq( DE, 1 );
	  contend_write_no_mreq( DE, 1 );
          contend_write_no_mreq( DE, 1 );
          reg_pc -=2;
        }
        HL++; DE++;


}


void instruccion_ed_177 ()
{
//coded177:               ;CPIR


        cpi_cpd_common();


        set_memptr(memptr+1);


        if ((Z80_FLAGS & FLAG_PV)==0 || (Z80_FLAGS & FLAG_Z)) {
		HL++;
		return;
	}

          contend_read_no_mreq( HL, 1 );
	  contend_read_no_mreq( HL, 1 );
          contend_read_no_mreq( HL, 1 );
	  contend_read_no_mreq( HL, 1 );
          contend_read_no_mreq( HL, 1 );

#ifdef EMULATE_MEMPTR
        set_memptr(reg_pc-1);
#endif

        reg_pc -=2;
	HL++;

}


void instruccion_ed_178 ()
{
//coded178:               ;INIR
        //instruccion_ed_162();

        z80_byte value,aux;

        contend_read_no_mreq( IR, 1 );


        value=lee_puerto(reg_b,reg_c);
        poke_byte(HL,value);
#ifdef EMULATE_MEMPTR
        set_memptr( BC+1  );
#endif
        reg_b--;

        aux=value+reg_c+1;
        if (value & 0x80) Z80_FLAGS |=FLAG_N;
        else Z80_FLAGS &=(255-FLAG_N);

        if (aux<value) {
                Z80_FLAGS |=FLAG_H|FLAG_C;
        }
        else {
                Z80_FLAGS &=(255-FLAG_H-FLAG_C);
        }

        Z80_FLAGS = (Z80_FLAGS & (255-FLAG_S-FLAG_Z-FLAG_3-FLAG_5) ) | sz53_table[reg_b];

        set_flags_parity(( aux & 0x07 ) ^ reg_b);

        if ( reg_b ) {
          contend_write_no_mreq( HL, 1 );
	  contend_write_no_mreq( HL, 1 );
          contend_write_no_mreq( HL, 1 );
	  contend_write_no_mreq( HL, 1 );
          contend_write_no_mreq( HL, 1 );
          reg_pc -= 2;
        }


        HL++;

}


void instruccion_ed_179 ()
{
//coded179:               ;OTIR
        instruccion_ed_163();

        if ( reg_b ) {
          contend_read_no_mreq( BC, 1 );
	  contend_read_no_mreq( BC, 1 );
          contend_read_no_mreq( BC, 1 );
	  contend_read_no_mreq( BC, 1 );
          contend_read_no_mreq( BC, 1 );
          reg_pc -= 2;
        }


}


void instruccion_ed_180 ()
{
        invalid_opcode_ed("ED180");
}

void instruccion_ed_181 ()
{
        invalid_opcode_ed("ED181");
}

void instruccion_ed_182 ()
{
        invalid_opcode_ed("ED182");
}

void instruccion_ed_183 ()
{
        invalid_opcode_ed("ED183");
}


void instruccion_ed_184 ()
{
//LDDR
#ifdef EMULATE_MEMPTR
        if (reg_b!=0 || reg_c!=1) set_memptr(reg_pc-1);
#endif

        //instruccion_ed_168();

        z80_byte byte_leido;

        byte_leido=peek_byte(HL);
        poke_byte(DE,byte_leido);

        contend_write_no_mreq( DE, 1 );
	contend_write_no_mreq( DE, 1 );

        BC--;

	Z80_FLAGS &=(255-FLAG_H-FLAG_N-FLAG_PV-FLAG_3-FLAG_5);


        if (byte_leido & 8 ) Z80_FLAGS |=FLAG_3;

        if (byte_leido & 2 ) Z80_FLAGS |=FLAG_5;

        if (BC) {
	  Z80_FLAGS |=FLAG_PV;
          contend_write_no_mreq( DE, 1 );
	  contend_write_no_mreq( DE, 1 );
          contend_write_no_mreq( DE, 1 );
	  contend_write_no_mreq( DE, 1 );
          contend_write_no_mreq( DE, 1 );
          reg_pc -=2;
        }
        HL--; DE--;


}


void instruccion_ed_185 ()
{
//coded177:               ;CPDR


        cpi_cpd_common();


        set_memptr(memptr-1);


        if ((Z80_FLAGS & FLAG_PV)==0 || (Z80_FLAGS & FLAG_Z)) {
		HL--;
		return;
	}

          contend_read_no_mreq( HL, 1 );
	  contend_read_no_mreq( HL, 1 );
          contend_read_no_mreq( HL, 1 );
	  contend_read_no_mreq( HL, 1 );
          contend_read_no_mreq( HL, 1 );

#ifdef EMULATE_MEMPTR
        set_memptr(reg_pc-1);
#endif

        reg_pc -=2;
	HL--;

}


void instruccion_ed_186 ()
{
//coded186:               ;INDR

        z80_byte value,aux;

        contend_read_no_mreq( IR, 1 );


        value=lee_puerto(reg_b,reg_c);
        poke_byte(HL,value);
#ifdef EMULATE_MEMPTR
        set_memptr( BC-1  );
#endif

        reg_b--;

        aux=value+reg_c-1;
        if (value & 0x80) Z80_FLAGS |=FLAG_N;
        else Z80_FLAGS &=(255-FLAG_N);

        if (aux<value) {
                Z80_FLAGS |=FLAG_H|FLAG_C;
        }
        else {
                Z80_FLAGS &=(255-FLAG_H-FLAG_C);
        }

        Z80_FLAGS = (Z80_FLAGS & (255-FLAG_S-FLAG_Z-FLAG_3-FLAG_5) ) | sz53_table[reg_b];

        set_flags_parity(( aux & 0x07 ) ^ reg_b);

        if (reg_b) {
          contend_write_no_mreq( HL, 1 );
	  contend_write_no_mreq( HL, 1 );
          contend_write_no_mreq( HL, 1 );
	  contend_write_no_mreq( HL, 1 );
          contend_write_no_mreq( HL, 1 );
          reg_pc -= 2;
        }

        HL--;

}


void instruccion_ed_187 ()
{
//coded187:               ;OTDR
        instruccion_ed_171();

        if ( reg_b ) {
          contend_read_no_mreq( BC, 1 );
	  contend_read_no_mreq( BC, 1 );
          contend_read_no_mreq( BC, 1 );
	  contend_read_no_mreq( BC, 1 );
          contend_read_no_mreq( BC, 1 );
          reg_pc -= 2;
        }

}


void instruccion_ed_188 ()
{
        invalid_opcode_ed("ED188");
}

void instruccion_ed_189 ()
{
        invalid_opcode_ed("ED189");
}

void instruccion_ed_190 ()
{
        invalid_opcode_ed("ED190");
}

void instruccion_ed_191 ()
{
        invalid_opcode_ed("ED191");
}

void instruccion_ed_192 ()
{
        invalid_opcode_ed("ED192");
}

void instruccion_ed_193 ()
{
        invalid_opcode_ed("ED193");
}

void instruccion_ed_194 ()
{
        invalid_opcode_ed("ED194");
}

void instruccion_ed_195 ()
{
        invalid_opcode_ed("ED195");
}

void instruccion_ed_196 ()
{
        invalid_opcode_ed("ED196");
}

void instruccion_ed_197 ()
{
        invalid_opcode_ed("ED197");
}

void instruccion_ed_198 ()
{
        invalid_opcode_ed("ED198");
}

void instruccion_ed_199 ()
{
        invalid_opcode_ed("ED199");
}

void instruccion_ed_200 ()
{
        invalid_opcode_ed("ED200");
}

void instruccion_ed_201 ()
{
        invalid_opcode_ed("ED201");
}

void instruccion_ed_202 ()
{
        invalid_opcode_ed("ED202");
}

void instruccion_ed_203 ()
{
        invalid_opcode_ed("ED203");
}

void instruccion_ed_204 ()
{
        invalid_opcode_ed("ED204");
}

void instruccion_ed_205 ()
{
        invalid_opcode_ed("ED205");
}

void instruccion_ed_206 ()
{
        invalid_opcode_ed("ED206");
}

void instruccion_ed_207 ()
{
        invalid_opcode_ed("ED207");
}

void instruccion_ed_208 ()
{
        invalid_opcode_ed("ED208");
}

void instruccion_ed_209 ()
{
        invalid_opcode_ed("ED209");
}

void instruccion_ed_210 ()
{
        invalid_opcode_ed("ED210");
}

void instruccion_ed_211 ()
{
        invalid_opcode_ed("ED211");
}

void instruccion_ed_212 ()
{
        invalid_opcode_ed("ED212");
}

void instruccion_ed_213 ()
{
        invalid_opcode_ed("ED213");
}

void instruccion_ed_214 ()
{
        invalid_opcode_ed("ED214");
}

void instruccion_ed_215 ()
{
        invalid_opcode_ed("ED215");
}

void instruccion_ed_216 ()
{
        invalid_opcode_ed("ED216");
}

void instruccion_ed_217 ()
{
        invalid_opcode_ed("ED217");
}

void instruccion_ed_218 ()
{
        invalid_opcode_ed("ED218");
}

void instruccion_ed_219 ()
{
        invalid_opcode_ed("ED219");
}

void instruccion_ed_220 ()
{
        invalid_opcode_ed("ED220");
}

void instruccion_ed_221 ()
{
        invalid_opcode_ed("ED221");
}

void instruccion_ed_222 ()
{
        invalid_opcode_ed("ED222");
}

void instruccion_ed_223 ()
{
        invalid_opcode_ed("ED223");
}

void instruccion_ed_224 ()
{
        invalid_opcode_ed("ED224");
}

void instruccion_ed_225 ()
{
        invalid_opcode_ed("ED225");
}

void instruccion_ed_226 ()
{
        invalid_opcode_ed("ED226");
}

void instruccion_ed_227 ()
{
        invalid_opcode_ed("ED227");
}

void instruccion_ed_228 ()
{
        invalid_opcode_ed("ED228");
}

void instruccion_ed_229 ()
{
        invalid_opcode_ed("ED229");
}

void instruccion_ed_230 ()
{
        invalid_opcode_ed("ED230");
}

void instruccion_ed_231 ()
{
        invalid_opcode_ed("ED231");
}

void instruccion_ed_232 ()
{
        invalid_opcode_ed("ED232");
}

void instruccion_ed_233 ()
{
        invalid_opcode_ed("ED233");
}

void instruccion_ed_234 ()
{
        invalid_opcode_ed("ED234");
}

void instruccion_ed_235 ()
{
        invalid_opcode_ed("ED235");
}

void instruccion_ed_236 ()
{
        invalid_opcode_ed("ED236");
}

void instruccion_ed_237 ()
{
        invalid_opcode_ed("ED237");
}

void instruccion_ed_238 ()
{
        invalid_opcode_ed("ED238");
}

void instruccion_ed_239 ()
{
        invalid_opcode_ed("ED239");
}

void instruccion_ed_240 ()
{
        invalid_opcode_ed("ED240");
}

void instruccion_ed_241 ()
{
        invalid_opcode_ed("ED241");
}

void instruccion_ed_242 ()
{
        invalid_opcode_ed("ED242");
}

void instruccion_ed_243 ()
{
        invalid_opcode_ed("ED243");
}

void instruccion_ed_244 ()
{
        invalid_opcode_ed("ED244");
}

void instruccion_ed_245 ()
{
        invalid_opcode_ed("ED245");
}

void instruccion_ed_246 ()
{
        invalid_opcode_ed("ED246");
}

void instruccion_ed_247 ()
{
        invalid_opcode_ed("ED247");
}

void instruccion_ed_248 ()
{
        invalid_opcode_ed("ED248");
}

void instruccion_ed_249 ()
{
        invalid_opcode_ed("ED249");
}

void instruccion_ed_250 ()
{
        invalid_opcode_ed("ED250");
}

void instruccion_ed_251 ()
{
        invalid_opcode_ed("ED251");
}

void instruccion_ed_252 ()
{
        invalid_opcode_ed("ED252");
}

void instruccion_ed_253 ()
{
        invalid_opcode_ed("ED253");
}

void instruccion_ed_254 ()
{
        invalid_opcode_ed("ED254");
}

void instruccion_ed_255 ()
{
        invalid_opcode_ed("ED255");
}



void (*codpred[]) ()   = {
instruccion_ed_0,
instruccion_ed_1,
instruccion_ed_2,
instruccion_ed_3,
instruccion_ed_4,
instruccion_ed_5,
instruccion_ed_6,
instruccion_ed_7,
instruccion_ed_8,
instruccion_ed_9,
instruccion_ed_10,
instruccion_ed_11,
instruccion_ed_12,
instruccion_ed_13,
instruccion_ed_14,
instruccion_ed_15,
instruccion_ed_16,
instruccion_ed_17,
instruccion_ed_18,
instruccion_ed_19,
instruccion_ed_20,
instruccion_ed_21,
instruccion_ed_22,
instruccion_ed_23,
instruccion_ed_24,
instruccion_ed_25,
instruccion_ed_26,
instruccion_ed_27,
instruccion_ed_28,
instruccion_ed_29,
instruccion_ed_30,
instruccion_ed_31,
instruccion_ed_32,
instruccion_ed_33,
instruccion_ed_34,
instruccion_ed_35,
instruccion_ed_36,
instruccion_ed_37,
instruccion_ed_38,
instruccion_ed_39,
instruccion_ed_40,
instruccion_ed_41,
instruccion_ed_42,
instruccion_ed_43,
instruccion_ed_44,
instruccion_ed_45,
instruccion_ed_46,
instruccion_ed_47,
instruccion_ed_48,
instruccion_ed_49,
instruccion_ed_50,
instruccion_ed_51,
instruccion_ed_52,
instruccion_ed_53,
instruccion_ed_54,
instruccion_ed_55,
instruccion_ed_56,
instruccion_ed_57,
instruccion_ed_58,
instruccion_ed_59,
instruccion_ed_60,
instruccion_ed_61,
instruccion_ed_62,
instruccion_ed_63,
instruccion_ed_64,
instruccion_ed_65,
instruccion_ed_66,
instruccion_ed_67,
instruccion_ed_68,
instruccion_ed_69,
instruccion_ed_70,
instruccion_ed_71,
instruccion_ed_72,
instruccion_ed_73,
instruccion_ed_74,
instruccion_ed_75,
instruccion_ed_76,
instruccion_ed_77,
instruccion_ed_78,
instruccion_ed_79,
instruccion_ed_80,
instruccion_ed_81,
instruccion_ed_82,
instruccion_ed_83,
instruccion_ed_84,
instruccion_ed_85,
instruccion_ed_86,
instruccion_ed_87,
instruccion_ed_88,
instruccion_ed_89,
instruccion_ed_90,
instruccion_ed_91,
instruccion_ed_92,
instruccion_ed_93,
instruccion_ed_94,
instruccion_ed_95,
instruccion_ed_96,
instruccion_ed_97,
instruccion_ed_98,
instruccion_ed_99,
instruccion_ed_100,
instruccion_ed_101,
instruccion_ed_102,
instruccion_ed_103,
instruccion_ed_104,
instruccion_ed_105,
instruccion_ed_106,
instruccion_ed_107,
instruccion_ed_108,
instruccion_ed_109,
instruccion_ed_110,
instruccion_ed_111,
instruccion_ed_112,
instruccion_ed_113,
instruccion_ed_114,
instruccion_ed_115,
instruccion_ed_116,
instruccion_ed_117,
instruccion_ed_118,
instruccion_ed_119,
instruccion_ed_120,
instruccion_ed_121,
instruccion_ed_122,
instruccion_ed_123,
instruccion_ed_124,
instruccion_ed_125,
instruccion_ed_126,
instruccion_ed_127,
instruccion_ed_128,
instruccion_ed_129,
instruccion_ed_130,
instruccion_ed_131,
instruccion_ed_132,
instruccion_ed_133,
instruccion_ed_134,
instruccion_ed_135,
instruccion_ed_136,
instruccion_ed_137,
instruccion_ed_138,
instruccion_ed_139,
instruccion_ed_140,
instruccion_ed_141,
instruccion_ed_142,
instruccion_ed_143,
instruccion_ed_144,
instruccion_ed_145,
instruccion_ed_146,
instruccion_ed_147,
instruccion_ed_148,
instruccion_ed_149,
instruccion_ed_150,
instruccion_ed_151,
instruccion_ed_152,
instruccion_ed_153,
instruccion_ed_154,
instruccion_ed_155,
instruccion_ed_156,
instruccion_ed_157,
instruccion_ed_158,
instruccion_ed_159,
instruccion_ed_160,
instruccion_ed_161,
instruccion_ed_162,
instruccion_ed_163,
instruccion_ed_164,
instruccion_ed_165,
instruccion_ed_166,
instruccion_ed_167,
instruccion_ed_168,
instruccion_ed_169,
instruccion_ed_170,
instruccion_ed_171,
instruccion_ed_172,
instruccion_ed_173,
instruccion_ed_174,
instruccion_ed_175,
instruccion_ed_176,
instruccion_ed_177,
instruccion_ed_178,
instruccion_ed_179,
instruccion_ed_180,
instruccion_ed_181,
instruccion_ed_182,
instruccion_ed_183,
instruccion_ed_184,
instruccion_ed_185,
instruccion_ed_186,
instruccion_ed_187,
instruccion_ed_188,
instruccion_ed_189,
instruccion_ed_190,
instruccion_ed_191,
instruccion_ed_192,
instruccion_ed_193,
instruccion_ed_194,
instruccion_ed_195,
instruccion_ed_196,
instruccion_ed_197,
instruccion_ed_198,
instruccion_ed_199,
instruccion_ed_200,
instruccion_ed_201,
instruccion_ed_202,
instruccion_ed_203,
instruccion_ed_204,
instruccion_ed_205,
instruccion_ed_206,
instruccion_ed_207,
instruccion_ed_208,
instruccion_ed_209,
instruccion_ed_210,
instruccion_ed_211,
instruccion_ed_212,
instruccion_ed_213,
instruccion_ed_214,
instruccion_ed_215,
instruccion_ed_216,
instruccion_ed_217,
instruccion_ed_218,
instruccion_ed_219,
instruccion_ed_220,
instruccion_ed_221,
instruccion_ed_222,
instruccion_ed_223,
instruccion_ed_224,
instruccion_ed_225,
instruccion_ed_226,
instruccion_ed_227,
instruccion_ed_228,
instruccion_ed_229,
instruccion_ed_230,
instruccion_ed_231,
instruccion_ed_232,
instruccion_ed_233,
instruccion_ed_234,
instruccion_ed_235,
instruccion_ed_236,
instruccion_ed_237,
instruccion_ed_238,
instruccion_ed_239,
instruccion_ed_240,
instruccion_ed_241,
instruccion_ed_242,
instruccion_ed_243,
instruccion_ed_244,
instruccion_ed_245,
instruccion_ed_246,
instruccion_ed_247,
instruccion_ed_248,
instruccion_ed_249,
instruccion_ed_250,
instruccion_ed_251,
instruccion_ed_252,
instruccion_ed_253,
instruccion_ed_254,
instruccion_ed_255

};
